{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":51,"column":48,"index":1933}}],"key":"8I802z/QkQYw0PV6ZCqhBNDwn0Q="}},{"name":"./withResolvers.js","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":4,"column":27,"index":157},"end":{"line":4,"column":56,"index":186}}],"key":"FXwL8k5684WWjc2bDlJoe2LEFwU="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _asyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.createBatchScheduler = createBatchScheduler;\n  var withResolvers_js_1 = require(_dependencyMap[1], \"./withResolvers.js\");\n  var schedulerCache = new Map();\n  function createBatchScheduler(_ref) {\n    var fn = _ref.fn,\n      id = _ref.id,\n      shouldSplitBatch = _ref.shouldSplitBatch,\n      _ref$wait = _ref.wait,\n      wait = _ref$wait === void 0 ? 0 : _ref$wait,\n      sort = _ref.sort;\n    var exec = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        var scheduler = getScheduler();\n        flush();\n        var args = scheduler.map(_ref3 => {\n          var args = _ref3.args;\n          return args;\n        });\n        if (args.length === 0) return;\n        fn(args).then(data => {\n          if (sort && Array.isArray(data)) data.sort(sort);\n          for (var i = 0; i < scheduler.length; i++) {\n            var resolve = scheduler[i].resolve;\n            resolve?.([data[i], data]);\n          }\n        }).catch(err => {\n          for (var i = 0; i < scheduler.length; i++) {\n            var reject = scheduler[i].reject;\n            reject?.(err);\n          }\n        });\n      });\n      return function exec() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var flush = () => schedulerCache.delete(id);\n    var getBatchedArgs = () => getScheduler().map(_ref4 => {\n      var args = _ref4.args;\n      return args;\n    });\n    var getScheduler = () => schedulerCache.get(id) || [];\n    var setScheduler = item => schedulerCache.set(id, [...getScheduler(), item]);\n    return {\n      flush,\n      schedule(args) {\n        return _asyncToGenerator(function* () {\n          var _ref5 = (0, withResolvers_js_1.withResolvers)(),\n            promise = _ref5.promise,\n            resolve = _ref5.resolve,\n            reject = _ref5.reject;\n          var split = shouldSplitBatch?.([...getBatchedArgs(), args]);\n          if (split) exec();\n          var hasActiveScheduler = getScheduler().length > 0;\n          if (hasActiveScheduler) {\n            setScheduler({\n              args,\n              resolve,\n              reject\n            });\n            return promise;\n          }\n          setScheduler({\n            args,\n            resolve,\n            reject\n          });\n          setTimeout(exec, wait);\n          return promise;\n        })();\n      }\n    };\n  }\n});","lineCount":81,"map":[[2,2,1,0],[2,14,1,12],[4,2,1,13],[4,6,1,13,"_asyncToGenerator"],[4,23,1,13],[4,26,1,13,"require"],[4,33,1,13],[4,34,1,13,"_dependencyMap"],[4,48,1,13],[5,2,2,0,"Object"],[5,8,2,6],[5,9,2,7,"defineProperty"],[5,23,2,21],[5,24,2,22,"exports"],[5,31,2,29],[5,33,2,31],[5,45,2,43],[5,47,2,45],[6,4,2,47,"value"],[6,9,2,52],[6,11,2,54],[7,2,2,59],[7,3,2,60],[7,4,2,61],[8,2,3,0,"exports"],[8,9,3,7],[8,10,3,8,"createBatchScheduler"],[8,30,3,28],[8,33,3,31,"createBatchScheduler"],[8,53,3,51],[9,2,4,0],[9,6,4,6,"withResolvers_js_1"],[9,24,4,24],[9,27,4,27,"require"],[9,34,4,34],[9,35,4,34,"_dependencyMap"],[9,49,4,34],[9,74,4,55],[9,75,4,56],[10,2,5,0],[10,6,5,6,"schedulerCache"],[10,20,5,20],[10,23,5,23],[10,27,5,27,"Map"],[10,30,5,30],[10,31,5,31],[10,32,5,32],[11,2,6,0],[11,11,6,9,"createBatchScheduler"],[11,31,6,29,"createBatchScheduler"],[11,32,6,29,"_ref"],[11,36,6,29],[11,38,6,77],[12,4,6,77],[12,8,6,32,"fn"],[12,10,6,34],[12,13,6,34,"_ref"],[12,17,6,34],[12,18,6,32,"fn"],[12,20,6,34],[13,6,6,36,"id"],[13,8,6,38],[13,11,6,38,"_ref"],[13,15,6,38],[13,16,6,36,"id"],[13,18,6,38],[14,6,6,40,"shouldSplitBatch"],[14,22,6,56],[14,25,6,56,"_ref"],[14,29,6,56],[14,30,6,40,"shouldSplitBatch"],[14,46,6,56],[15,6,6,56,"_ref$wait"],[15,15,6,56],[15,18,6,56,"_ref"],[15,22,6,56],[15,23,6,58,"wait"],[15,27,6,62],[16,6,6,58,"wait"],[16,10,6,62],[16,13,6,62,"_ref$wait"],[16,22,6,62],[16,36,6,65],[16,37,6,66],[16,40,6,66,"_ref$wait"],[16,49,6,66],[17,6,6,68,"sort"],[17,10,6,72],[17,13,6,72,"_ref"],[17,17,6,72],[17,18,6,68,"sort"],[17,22,6,72],[18,4,7,4],[18,8,7,10,"exec"],[18,12,7,14],[19,6,7,14],[19,10,7,14,"_ref2"],[19,15,7,14],[19,18,7,14,"_asyncToGenerator"],[19,35,7,14],[19,36,7,17],[19,49,7,29],[20,8,8,8],[20,12,8,14,"scheduler"],[20,21,8,23],[20,24,8,26,"getScheduler"],[20,36,8,38],[20,37,8,39],[20,38,8,40],[21,8,9,8,"flush"],[21,13,9,13],[21,14,9,14],[21,15,9,15],[22,8,10,8],[22,12,10,14,"args"],[22,16,10,18],[22,19,10,21,"scheduler"],[22,28,10,30],[22,29,10,31,"map"],[22,32,10,34],[22,33,10,35,"_ref3"],[22,38,10,35],[23,10,10,35],[23,14,10,38,"args"],[23,18,10,42],[23,21,10,42,"_ref3"],[23,26,10,42],[23,27,10,38,"args"],[23,31,10,42],[24,10,10,42],[24,17,10,49,"args"],[24,21,10,53],[25,8,10,53],[25,10,10,54],[26,8,11,8],[26,12,11,12,"args"],[26,16,11,16],[26,17,11,17,"length"],[26,23,11,23],[26,28,11,28],[26,29,11,29],[26,31,12,12],[27,8,13,8,"fn"],[27,10,13,10],[27,11,13,11,"args"],[27,15,13,15],[27,16,13,16],[27,17,14,13,"then"],[27,21,14,17],[27,22,14,19,"data"],[27,26,14,23],[27,30,14,28],[28,10,15,12],[28,14,15,16,"sort"],[28,18,15,20],[28,22,15,24,"Array"],[28,27,15,29],[28,28,15,30,"isArray"],[28,35,15,37],[28,36,15,38,"data"],[28,40,15,42],[28,41,15,43],[28,43,16,16,"data"],[28,47,16,20],[28,48,16,21,"sort"],[28,52,16,25],[28,53,16,26,"sort"],[28,57,16,30],[28,58,16,31],[29,10,17,12],[29,15,17,17],[29,19,17,21,"i"],[29,20,17,22],[29,23,17,25],[29,24,17,26],[29,26,17,28,"i"],[29,27,17,29],[29,30,17,32,"scheduler"],[29,39,17,41],[29,40,17,42,"length"],[29,46,17,48],[29,48,17,50,"i"],[29,49,17,51],[29,51,17,53],[29,53,17,55],[30,12,18,16],[30,16,18,24,"resolve"],[30,23,18,31],[30,26,18,36,"scheduler"],[30,35,18,45],[30,36,18,46,"i"],[30,37,18,47],[30,38,18,48],[30,39,18,24,"resolve"],[30,46,18,31],[31,12,19,16,"resolve"],[31,19,19,23],[31,22,19,26],[31,23,19,27,"data"],[31,27,19,31],[31,28,19,32,"i"],[31,29,19,33],[31,30,19,34],[31,32,19,36,"data"],[31,36,19,40],[31,37,19,41],[31,38,19,42],[32,10,20,12],[33,8,21,8],[33,9,21,9],[33,10,21,10],[33,11,22,13,"catch"],[33,16,22,18],[33,17,22,20,"err"],[33,20,22,23],[33,24,22,28],[34,10,23,12],[34,15,23,17],[34,19,23,21,"i"],[34,20,23,22],[34,23,23,25],[34,24,23,26],[34,26,23,28,"i"],[34,27,23,29],[34,30,23,32,"scheduler"],[34,39,23,41],[34,40,23,42,"length"],[34,46,23,48],[34,48,23,50,"i"],[34,49,23,51],[34,51,23,53],[34,53,23,55],[35,12,24,16],[35,16,24,24,"reject"],[35,22,24,30],[35,25,24,35,"scheduler"],[35,34,24,44],[35,35,24,45,"i"],[35,36,24,46],[35,37,24,47],[35,38,24,24,"reject"],[35,44,24,30],[36,12,25,16,"reject"],[36,18,25,22],[36,21,25,25,"err"],[36,24,25,28],[36,25,25,29],[37,10,26,12],[38,8,27,8],[38,9,27,9],[38,10,27,10],[39,6,28,4],[39,7,28,5],[40,6,28,5],[40,22,7,10,"exec"],[40,26,7,14,"exec"],[40,27,7,14],[41,8,7,14],[41,15,7,14,"_ref2"],[41,20,7,14],[41,21,7,14,"apply"],[41,26,7,14],[41,33,7,14,"arguments"],[41,42,7,14],[42,6,7,14],[43,4,7,14],[43,7,28,5],[44,4,29,4],[44,8,29,10,"flush"],[44,13,29,15],[44,16,29,18,"flush"],[44,17,29,18],[44,22,29,24,"schedulerCache"],[44,36,29,38],[44,37,29,39,"delete"],[44,43,29,45],[44,44,29,46,"id"],[44,46,29,48],[44,47,29,49],[45,4,30,4],[45,8,30,10,"getBatchedArgs"],[45,22,30,24],[45,25,30,27,"getBatchedArgs"],[45,26,30,27],[45,31,30,33,"getScheduler"],[45,43,30,45],[45,44,30,46],[45,45,30,47],[45,46,30,48,"map"],[45,49,30,51],[45,50,30,52,"_ref4"],[45,55,30,52],[46,6,30,52],[46,10,30,55,"args"],[46,14,30,59],[46,17,30,59,"_ref4"],[46,22,30,59],[46,23,30,55,"args"],[46,27,30,59],[47,6,30,59],[47,13,30,66,"args"],[47,17,30,70],[48,4,30,70],[48,6,30,71],[49,4,31,4],[49,8,31,10,"getScheduler"],[49,20,31,22],[49,23,31,25,"getScheduler"],[49,24,31,25],[49,29,31,31,"schedulerCache"],[49,43,31,45],[49,44,31,46,"get"],[49,47,31,49],[49,48,31,50,"id"],[49,50,31,52],[49,51,31,53],[49,55,31,57],[49,57,31,59],[50,4,32,4],[50,8,32,10,"setScheduler"],[50,20,32,22],[50,23,32,26,"item"],[50,27,32,30],[50,31,32,35,"schedulerCache"],[50,45,32,49],[50,46,32,50,"set"],[50,49,32,53],[50,50,32,54,"id"],[50,52,32,56],[50,54,32,58],[50,55,32,59],[50,58,32,62,"getScheduler"],[50,70,32,74],[50,71,32,75],[50,72,32,76],[50,74,32,78,"item"],[50,78,32,82],[50,79,32,83],[50,80,32,84],[51,4,33,4],[51,11,33,11],[52,6,34,8,"flush"],[52,11,34,13],[53,6,35,14,"schedule"],[53,14,35,22,"schedule"],[53,15,35,23,"args"],[53,19,35,27],[53,21,35,29],[54,8,35,29],[54,15,35,29,"_asyncToGenerator"],[54,32,35,29],[55,10,36,12],[55,14,36,12,"_ref5"],[55,19,36,12],[55,22,36,49],[55,23,36,50],[55,24,36,51],[55,26,36,53,"withResolvers_js_1"],[55,44,36,71],[55,45,36,72,"withResolvers"],[55,58,36,85],[55,60,36,87],[55,61,36,88],[56,12,36,20,"promise"],[56,19,36,27],[56,22,36,27,"_ref5"],[56,27,36,27],[56,28,36,20,"promise"],[56,35,36,27],[57,12,36,29,"resolve"],[57,19,36,36],[57,22,36,36,"_ref5"],[57,27,36,36],[57,28,36,29,"resolve"],[57,35,36,36],[58,12,36,38,"reject"],[58,18,36,44],[58,21,36,44,"_ref5"],[58,26,36,44],[58,27,36,38,"reject"],[58,33,36,44],[59,10,37,12],[59,14,37,18,"split"],[59,19,37,23],[59,22,37,26,"shouldSplitBatch"],[59,38,37,42],[59,41,37,45],[59,42,37,46],[59,45,37,49,"getBatchedArgs"],[59,59,37,63],[59,60,37,64],[59,61,37,65],[59,63,37,67,"args"],[59,67,37,71],[59,68,37,72],[59,69,37,73],[60,10,38,12],[60,14,38,16,"split"],[60,19,38,21],[60,21,39,16,"exec"],[60,25,39,20],[60,26,39,21],[60,27,39,22],[61,10,40,12],[61,14,40,18,"hasActiveScheduler"],[61,32,40,36],[61,35,40,39,"getScheduler"],[61,47,40,51],[61,48,40,52],[61,49,40,53],[61,50,40,54,"length"],[61,56,40,60],[61,59,40,63],[61,60,40,64],[62,10,41,12],[62,14,41,16,"hasActiveScheduler"],[62,32,41,34],[62,34,41,36],[63,12,42,16,"setScheduler"],[63,24,42,28],[63,25,42,29],[64,14,42,31,"args"],[64,18,42,35],[65,14,42,37,"resolve"],[65,21,42,44],[66,14,42,46,"reject"],[67,12,42,53],[67,13,42,54],[67,14,42,55],[68,12,43,16],[68,19,43,23,"promise"],[68,26,43,30],[69,10,44,12],[70,10,45,12,"setScheduler"],[70,22,45,24],[70,23,45,25],[71,12,45,27,"args"],[71,16,45,31],[72,12,45,33,"resolve"],[72,19,45,40],[73,12,45,42,"reject"],[74,10,45,49],[74,11,45,50],[74,12,45,51],[75,10,46,12,"setTimeout"],[75,20,46,22],[75,21,46,23,"exec"],[75,25,46,27],[75,27,46,29,"wait"],[75,31,46,33],[75,32,46,34],[76,10,47,12],[76,17,47,19,"promise"],[76,24,47,26],[77,8,47,27],[78,6,48,8],[79,4,49,4],[79,5,49,5],[80,2,50,0],[81,0,50,1],[81,3]],"functionMap":{"names":["<global>","createBatchScheduler","exec","scheduler.map$argument_0","fn.then$argument_0","fn.then._catch$argument_0","flush","getBatchedArgs","getScheduler.map$argument_0","getScheduler","setScheduler","schedule"],"mappings":"AAA;ACK;iBCC;mCCG,kBD;kBEI;SFO;mBGC;SHK;KDC;kBKC,+BL;2BMC,yBC,kBD,CN;yBQC,kCR;yBSC,2DT;QUG;SVa;CDE"}},"type":"js/module"}]}