{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":73,"column":40,"index":2727}}],"key":"8I802z/QkQYw0PV6ZCqhBNDwn0Q="}},{"name":"../actions/public/getTransactionCount.js","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":6,"column":33,"index":217},"end":{"line":6,"column":84,"index":268}}],"key":"6nArvhZn7Dz3SRNkYKVGSvpqNBY="}},{"name":"./lru.js","data":{"asyncType":null,"exportNames":["*"],"locs":[{"start":{"line":7,"column":17,"index":287},"end":{"line":7,"column":36,"index":306}}],"key":"RUbOhuEeO6dVSVk3OXYJ6iJGEXI="}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _asyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.nonceManager = void 0;\n  exports.createNonceManager = createNonceManager;\n  exports.jsonRpc = jsonRpc;\n  var getTransactionCount_js_1 = require(_dependencyMap[1], \"../actions/public/getTransactionCount.js\");\n  var lru_js_1 = require(_dependencyMap[2], \"./lru.js\");\n  function createNonceManager(parameters) {\n    var source = parameters.source;\n    var deltaMap = new Map();\n    var nonceMap = new lru_js_1.LruMap(8192);\n    var promiseMap = new Map();\n    var getKey = _ref => {\n      var address = _ref.address,\n        chainId = _ref.chainId;\n      return `${address}.${chainId}`;\n    };\n    return {\n      consume(_ref2) {\n        var _this = this;\n        return _asyncToGenerator(function* () {\n          var address = _ref2.address,\n            chainId = _ref2.chainId,\n            client = _ref2.client;\n          var key = getKey({\n            address,\n            chainId\n          });\n          var promise = _this.get({\n            address,\n            chainId,\n            client\n          });\n          _this.increment({\n            address,\n            chainId\n          });\n          var nonce = yield promise;\n          yield source.set({\n            address,\n            chainId\n          }, nonce);\n          nonceMap.set(key, nonce);\n          return nonce;\n        })();\n      },\n      increment(_ref3) {\n        return _asyncToGenerator(function* () {\n          var address = _ref3.address,\n            chainId = _ref3.chainId;\n          var key = getKey({\n            address,\n            chainId\n          });\n          var delta = deltaMap.get(key) ?? 0;\n          deltaMap.set(key, delta + 1);\n        })();\n      },\n      get(_ref4) {\n        var _this2 = this;\n        return _asyncToGenerator(function* () {\n          var address = _ref4.address,\n            chainId = _ref4.chainId,\n            client = _ref4.client;\n          var key = getKey({\n            address,\n            chainId\n          });\n          var promise = promiseMap.get(key);\n          if (!promise) {\n            promise = _asyncToGenerator(function* () {\n              try {\n                var nonce = yield source.get({\n                  address,\n                  chainId,\n                  client\n                });\n                var previousNonce = nonceMap.get(key) ?? 0;\n                if (previousNonce > 0 && nonce <= previousNonce) return previousNonce + 1;\n                nonceMap.delete(key);\n                return nonce;\n              } finally {\n                _this2.reset({\n                  address,\n                  chainId\n                });\n              }\n            })();\n            promiseMap.set(key, promise);\n          }\n          var delta = deltaMap.get(key) ?? 0;\n          return delta + (yield promise);\n        })();\n      },\n      reset(_ref6) {\n        var address = _ref6.address,\n          chainId = _ref6.chainId;\n        var key = getKey({\n          address,\n          chainId\n        });\n        deltaMap.delete(key);\n        promiseMap.delete(key);\n      }\n    };\n  }\n  function jsonRpc() {\n    return {\n      get(parameters) {\n        return _asyncToGenerator(function* () {\n          var address = parameters.address,\n            client = parameters.client;\n          return (0, getTransactionCount_js_1.getTransactionCount)(client, {\n            address,\n            blockTag: 'pending'\n          });\n        })();\n      },\n      set() {}\n    };\n  }\n  exports.nonceManager = createNonceManager({\n    source: jsonRpc()\n  });\n});","lineCount":130,"map":[[2,2,1,0],[2,14,1,12],[4,2,1,13],[4,6,1,13,"_asyncToGenerator"],[4,23,1,13],[4,26,1,13,"require"],[4,33,1,13],[4,34,1,13,"_dependencyMap"],[4,48,1,13],[5,2,2,0,"Object"],[5,8,2,6],[5,9,2,7,"defineProperty"],[5,23,2,21],[5,24,2,22,"exports"],[5,31,2,29],[5,33,2,31],[5,45,2,43],[5,47,2,45],[6,4,2,47,"value"],[6,9,2,52],[6,11,2,54],[7,2,2,59],[7,3,2,60],[7,4,2,61],[8,2,3,0,"exports"],[8,9,3,7],[8,10,3,8,"nonceManager"],[8,22,3,20],[8,25,3,23],[8,30,3,28],[8,31,3,29],[9,2,4,0,"exports"],[9,9,4,7],[9,10,4,8,"createNonceManager"],[9,28,4,26],[9,31,4,29,"createNonceManager"],[9,49,4,47],[10,2,5,0,"exports"],[10,9,5,7],[10,10,5,8,"jsonRpc"],[10,17,5,15],[10,20,5,18,"jsonRpc"],[10,27,5,25],[11,2,6,0],[11,6,6,6,"getTransactionCount_js_1"],[11,30,6,30],[11,33,6,33,"require"],[11,40,6,40],[11,41,6,40,"_dependencyMap"],[11,55,6,40],[11,102,6,83],[11,103,6,84],[12,2,7,0],[12,6,7,6,"lru_js_1"],[12,14,7,14],[12,17,7,17,"require"],[12,24,7,24],[12,25,7,24,"_dependencyMap"],[12,39,7,24],[12,54,7,35],[12,55,7,36],[13,2,8,0],[13,11,8,9,"createNonceManager"],[13,29,8,27,"createNonceManager"],[13,30,8,28,"parameters"],[13,40,8,38],[13,42,8,40],[14,4,9,4],[14,8,9,12,"source"],[14,14,9,18],[14,17,9,23,"parameters"],[14,27,9,33],[14,28,9,12,"source"],[14,34,9,18],[15,4,10,4],[15,8,10,10,"deltaMap"],[15,16,10,18],[15,19,10,21],[15,23,10,25,"Map"],[15,26,10,28],[15,27,10,29],[15,28,10,30],[16,4,11,4],[16,8,11,10,"nonceMap"],[16,16,11,18],[16,19,11,21],[16,23,11,25,"lru_js_1"],[16,31,11,33],[16,32,11,34,"LruMap"],[16,38,11,40],[16,39,11,41],[16,43,11,45],[16,44,11,46],[17,4,12,4],[17,8,12,10,"promiseMap"],[17,18,12,20],[17,21,12,23],[17,25,12,27,"Map"],[17,28,12,30],[17,29,12,31],[17,30,12,32],[18,4,13,4],[18,8,13,10,"getKey"],[18,14,13,16],[18,17,13,19,"_ref"],[18,21,13,19],[19,6,13,19],[19,10,13,22,"address"],[19,17,13,29],[19,20,13,29,"_ref"],[19,24,13,29],[19,25,13,22,"address"],[19,32,13,29],[20,8,13,31,"chainId"],[20,15,13,38],[20,18,13,38,"_ref"],[20,22,13,38],[20,23,13,31,"chainId"],[20,30,13,38],[21,6,13,38],[21,13,13,45],[21,16,13,48,"address"],[21,23,13,55],[21,27,13,59,"chainId"],[21,34,13,66],[21,36,13,68],[22,4,13,68],[23,4,14,4],[23,11,14,11],[24,6,15,14,"consume"],[24,13,15,21,"consume"],[24,14,15,21,"_ref2"],[24,19,15,21],[24,21,15,52],[25,8,15,52],[25,12,15,52,"_this"],[25,17,15,52],[26,8,15,52],[26,15,15,52,"_asyncToGenerator"],[26,32,15,52],[27,10,15,52],[27,14,15,24,"address"],[27,21,15,31],[27,24,15,31,"_ref2"],[27,29,15,31],[27,30,15,24,"address"],[27,37,15,31],[28,12,15,33,"chainId"],[28,19,15,40],[28,22,15,40,"_ref2"],[28,27,15,40],[28,28,15,33,"chainId"],[28,35,15,40],[29,12,15,42,"client"],[29,18,15,48],[29,21,15,48,"_ref2"],[29,26,15,48],[29,27,15,42,"client"],[29,33,15,48],[30,10,16,12],[30,14,16,18,"key"],[30,17,16,21],[30,20,16,24,"getKey"],[30,26,16,30],[30,27,16,31],[31,12,16,33,"address"],[31,19,16,40],[32,12,16,42,"chainId"],[33,10,16,50],[33,11,16,51],[33,12,16,52],[34,10,17,12],[34,14,17,18,"promise"],[34,21,17,25],[34,24,17,28,"_this"],[34,29,17,32],[34,30,17,33,"get"],[34,33,17,36],[34,34,17,37],[35,12,17,39,"address"],[35,19,17,46],[36,12,17,48,"chainId"],[36,19,17,55],[37,12,17,57,"client"],[38,10,17,64],[38,11,17,65],[38,12,17,66],[39,10,18,12,"_this"],[39,15,18,16],[39,16,18,17,"increment"],[39,25,18,26],[39,26,18,27],[40,12,18,29,"address"],[40,19,18,36],[41,12,18,38,"chainId"],[42,10,18,46],[42,11,18,47],[42,12,18,48],[43,10,19,12],[43,14,19,18,"nonce"],[43,19,19,23],[43,28,19,32,"promise"],[43,35,19,39],[44,10,20,12],[44,16,20,18,"source"],[44,22,20,24],[44,23,20,25,"set"],[44,26,20,28],[44,27,20,29],[45,12,20,31,"address"],[45,19,20,38],[46,12,20,40,"chainId"],[47,10,20,48],[47,11,20,49],[47,13,20,51,"nonce"],[47,18,20,56],[47,19,20,57],[48,10,21,12,"nonceMap"],[48,18,21,20],[48,19,21,21,"set"],[48,22,21,24],[48,23,21,25,"key"],[48,26,21,28],[48,28,21,30,"nonce"],[48,33,21,35],[48,34,21,36],[49,10,22,12],[49,17,22,19,"nonce"],[49,22,22,24],[50,8,22,25],[51,6,23,8],[51,7,23,9],[52,6,24,14,"increment"],[52,15,24,23,"increment"],[52,16,24,23,"_ref3"],[52,21,24,23],[52,23,24,46],[53,8,24,46],[53,15,24,46,"_asyncToGenerator"],[53,32,24,46],[54,10,24,46],[54,14,24,26,"address"],[54,21,24,33],[54,24,24,33,"_ref3"],[54,29,24,33],[54,30,24,26,"address"],[54,37,24,33],[55,12,24,35,"chainId"],[55,19,24,42],[55,22,24,42,"_ref3"],[55,27,24,42],[55,28,24,35,"chainId"],[55,35,24,42],[56,10,25,12],[56,14,25,18,"key"],[56,17,25,21],[56,20,25,24,"getKey"],[56,26,25,30],[56,27,25,31],[57,12,25,33,"address"],[57,19,25,40],[58,12,25,42,"chainId"],[59,10,25,50],[59,11,25,51],[59,12,25,52],[60,10,26,12],[60,14,26,18,"delta"],[60,19,26,23],[60,22,26,26,"deltaMap"],[60,30,26,34],[60,31,26,35,"get"],[60,34,26,38],[60,35,26,39,"key"],[60,38,26,42],[60,39,26,43],[60,43,26,47],[60,44,26,48],[61,10,27,12,"deltaMap"],[61,18,27,20],[61,19,27,21,"set"],[61,22,27,24],[61,23,27,25,"key"],[61,26,27,28],[61,28,27,30,"delta"],[61,33,27,35],[61,36,27,38],[61,37,27,39],[61,38,27,40],[62,8,27,41],[63,6,28,8],[63,7,28,9],[64,6,29,14,"get"],[64,9,29,17,"get"],[64,10,29,17,"_ref4"],[64,15,29,17],[64,17,29,48],[65,8,29,48],[65,12,29,48,"_this2"],[65,18,29,48],[66,8,29,48],[66,15,29,48,"_asyncToGenerator"],[66,32,29,48],[67,10,29,48],[67,14,29,20,"address"],[67,21,29,27],[67,24,29,27,"_ref4"],[67,29,29,27],[67,30,29,20,"address"],[67,37,29,27],[68,12,29,29,"chainId"],[68,19,29,36],[68,22,29,36,"_ref4"],[68,27,29,36],[68,28,29,29,"chainId"],[68,35,29,36],[69,12,29,38,"client"],[69,18,29,44],[69,21,29,44,"_ref4"],[69,26,29,44],[69,27,29,38,"client"],[69,33,29,44],[70,10,30,12],[70,14,30,18,"key"],[70,17,30,21],[70,20,30,24,"getKey"],[70,26,30,30],[70,27,30,31],[71,12,30,33,"address"],[71,19,30,40],[72,12,30,42,"chainId"],[73,10,30,50],[73,11,30,51],[73,12,30,52],[74,10,31,12],[74,14,31,16,"promise"],[74,21,31,23],[74,24,31,26,"promiseMap"],[74,34,31,36],[74,35,31,37,"get"],[74,38,31,40],[74,39,31,41,"key"],[74,42,31,44],[74,43,31,45],[75,10,32,12],[75,14,32,16],[75,15,32,17,"promise"],[75,22,32,24],[75,24,32,26],[76,12,33,16,"promise"],[76,19,33,23],[76,22,33,26,"_asyncToGenerator"],[76,39,33,26],[76,40,33,27],[76,53,33,39],[77,14,34,20],[77,18,34,24],[78,16,35,24],[78,20,35,30,"nonce"],[78,25,35,35],[78,34,35,44,"source"],[78,40,35,50],[78,41,35,51,"get"],[78,44,35,54],[78,45,35,55],[79,18,35,57,"address"],[79,25,35,64],[80,18,35,66,"chainId"],[80,25,35,73],[81,18,35,75,"client"],[82,16,35,82],[82,17,35,83],[82,18,35,84],[83,16,36,24],[83,20,36,30,"previousNonce"],[83,33,36,43],[83,36,36,46,"nonceMap"],[83,44,36,54],[83,45,36,55,"get"],[83,48,36,58],[83,49,36,59,"key"],[83,52,36,62],[83,53,36,63],[83,57,36,67],[83,58,36,68],[84,16,37,24],[84,20,37,28,"previousNonce"],[84,33,37,41],[84,36,37,44],[84,37,37,45],[84,41,37,49,"nonce"],[84,46,37,54],[84,50,37,58,"previousNonce"],[84,63,37,71],[84,65,38,28],[84,72,38,35,"previousNonce"],[84,85,38,48],[84,88,38,51],[84,89,38,52],[85,16,39,24,"nonceMap"],[85,24,39,32],[85,25,39,33,"delete"],[85,31,39,39],[85,32,39,40,"key"],[85,35,39,43],[85,36,39,44],[86,16,40,24],[86,23,40,31,"nonce"],[86,28,40,36],[87,14,41,20],[87,15,41,21],[87,24,42,28],[88,16,43,24,"_this2"],[88,22,43,28],[88,23,43,29,"reset"],[88,28,43,34],[88,29,43,35],[89,18,43,37,"address"],[89,25,43,44],[90,18,43,46,"chainId"],[91,16,43,54],[91,17,43,55],[91,18,43,56],[92,14,44,20],[93,12,45,16],[93,13,45,17],[93,15,45,19],[93,16,45,20],[94,12,46,16,"promiseMap"],[94,22,46,26],[94,23,46,27,"set"],[94,26,46,30],[94,27,46,31,"key"],[94,30,46,34],[94,32,46,36,"promise"],[94,39,46,43],[94,40,46,44],[95,10,47,12],[96,10,48,12],[96,14,48,18,"delta"],[96,19,48,23],[96,22,48,26,"deltaMap"],[96,30,48,34],[96,31,48,35,"get"],[96,34,48,38],[96,35,48,39,"key"],[96,38,48,42],[96,39,48,43],[96,43,48,47],[96,44,48,48],[97,10,49,12],[97,17,49,19,"delta"],[97,22,49,24],[97,32,49,34,"promise"],[97,39,49,41],[97,40,49,42],[98,8,49,43],[99,6,50,8],[99,7,50,9],[100,6,51,8,"reset"],[100,11,51,13,"reset"],[100,12,51,13,"_ref6"],[100,17,51,13],[100,19,51,36],[101,8,51,36],[101,12,51,16,"address"],[101,19,51,23],[101,22,51,23,"_ref6"],[101,27,51,23],[101,28,51,16,"address"],[101,35,51,23],[102,10,51,25,"chainId"],[102,17,51,32],[102,20,51,32,"_ref6"],[102,25,51,32],[102,26,51,25,"chainId"],[102,33,51,32],[103,8,52,12],[103,12,52,18,"key"],[103,15,52,21],[103,18,52,24,"getKey"],[103,24,52,30],[103,25,52,31],[104,10,52,33,"address"],[104,17,52,40],[105,10,52,42,"chainId"],[106,8,52,50],[106,9,52,51],[106,10,52,52],[107,8,53,12,"deltaMap"],[107,16,53,20],[107,17,53,21,"delete"],[107,23,53,27],[107,24,53,28,"key"],[107,27,53,31],[107,28,53,32],[108,8,54,12,"promiseMap"],[108,18,54,22],[108,19,54,23,"delete"],[108,25,54,29],[108,26,54,30,"key"],[108,29,54,33],[108,30,54,34],[109,6,55,8],[110,4,56,4],[110,5,56,5],[111,2,57,0],[112,2,58,0],[112,11,58,9,"jsonRpc"],[112,18,58,16,"jsonRpc"],[112,19,58,16],[112,21,58,19],[113,4,59,4],[113,11,59,11],[114,6,60,14,"get"],[114,9,60,17,"get"],[114,10,60,18,"parameters"],[114,20,60,28],[114,22,60,30],[115,8,60,30],[115,15,60,30,"_asyncToGenerator"],[115,32,60,30],[116,10,61,12],[116,14,61,20,"address"],[116,21,61,27],[116,24,61,40,"parameters"],[116,34,61,50],[116,35,61,20,"address"],[116,42,61,27],[117,12,61,29,"client"],[117,18,61,35],[117,21,61,40,"parameters"],[117,31,61,50],[117,32,61,29,"client"],[117,38,61,35],[118,10,62,12],[118,17,62,19],[118,18,62,20],[118,19,62,21],[118,21,62,23,"getTransactionCount_js_1"],[118,45,62,47],[118,46,62,48,"getTransactionCount"],[118,65,62,67],[118,67,62,69,"client"],[118,73,62,75],[118,75,62,77],[119,12,63,16,"address"],[119,19,63,23],[120,12,64,16,"blockTag"],[120,20,64,24],[120,22,64,26],[121,10,65,12],[121,11,65,13],[121,12,65,14],[122,8,65,15],[123,6,66,8],[123,7,66,9],[124,6,67,8,"set"],[124,9,67,11,"set"],[124,10,67,11],[124,12,67,14],[124,13,67,16],[125,4,68,4],[125,5,68,5],[126,2,69,0],[127,2,70,0,"exports"],[127,9,70,7],[127,10,70,8,"nonceManager"],[127,22,70,20],[127,25,70,23,"createNonceManager"],[127,43,70,41],[127,44,70,42],[128,4,71,4,"source"],[128,10,71,10],[128,12,71,12,"jsonRpc"],[128,19,71,19],[128,20,71,20],[129,2,72,0],[129,3,72,1],[129,4,72,2],[130,0,72,3],[130,3]],"functionMap":{"names":["<global>","createNonceManager","getKey","consume","increment","get","<anonymous>","reset","jsonRpc","set"],"mappings":"AAA;ACO;mBCK,iDD;QEE;SFQ;QGC;SHI;QIC;2BCI;iBDY;SJK;QMC;SNI;CDE;AQC;QHE;SGM;QCC,SD;CRE"}},"type":"js/module"}]}